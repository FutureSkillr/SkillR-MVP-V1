---
name: release-notes
description: Generate changelog from commits since last deploy — grouped by type, linked to FRs
allowed-tools: Read, Glob, Grep, Bash
---

# Release Notes — Changelog Generator

Generate a structured changelog from git commits, grouped by type and linked to Feature Requests.

## When to Run

Before or after a deployment, or when preparing stakeholder updates.

## Procedure

### 1. Determine Range

Find the last deployment timestamp:

```bash
# Option A: from deployment logs
ls -t docs/ops/deployments/deploy-*.html | head -1 | grep -oE '[0-9]{8}-[0-9]{6}'

# Option B: from git tags
git tag --sort=-creatordate | head -1

# Option C: from a specific commit
# The user may provide a commit SHA or "since yesterday"
```

If no reference point is found, default to the last 24 hours:

```bash
git log --oneline --since="24 hours ago"
```

### 2. Collect Commits

```bash
git log --format="%H|%s|%an|%ai" ${SINCE_REF}..HEAD
```

Parse each commit into: hash, subject, author, date.

### 3. Categorize Commits

Group by conventional commit prefix:

| Prefix | Category | Label |
|--------|----------|-------|
| `feat` | Features | New |
| `fix` | Bug Fixes | Fix |
| `chore` | Maintenance | Chore |
| `docs` | Documentation | Docs |
| `refactor` | Refactoring | Refactor |
| `test` | Tests | Test |
| `perf` | Performance | Perf |

Commits without a prefix go into "Other".

### 4. Extract FR/TC/OBS References

For each commit, search the subject and body for references:

```bash
git log --format="%B" ${HASH} -1 | grep -oE '(FR|TC|OBS)-[0-9]+'
```

Also check changed files for FR/TC connections:

```bash
git diff-tree --no-commit-id --name-only -r ${HASH} | grep -E '(FR-|TC-|OBS-)' | grep -oE '(FR|TC|OBS)-[0-9]+'
```

### 5. Count Stats

```bash
# Files changed
git diff --stat ${SINCE_REF}..HEAD | tail -1

# Lines added/removed
git diff --shortstat ${SINCE_REF}..HEAD

# Contributors
git log --format="%an" ${SINCE_REF}..HEAD | sort -u
```

### 6. Generate Report

```markdown
# Release Notes — {YYYY-MM-DD}

**Range:** {since_ref}..HEAD ({N} commits)
**Authors:** {list}
**Stats:** {N} files changed, {+N} insertions, {-N} deletions

## Features

- **{commit subject}** ({short_hash}) — Refs: {FR-NNN}
- ...

## Bug Fixes

- **{commit subject}** ({short_hash}) — Refs: {OBS-NNN}
- ...

## Maintenance

- **{commit subject}** ({short_hash})
- ...

## Documentation

- **{commit subject}** ({short_hash})
- ...

## Related Documents

| Type | ID | Title |
|------|-----|-------|
| FR | FR-NNN | {title from file} |
| OBS | OBS-NNN | {title from file} |

---

*Generated by `/release-notes` on {date}*
```

### 7. Output Only

This skill outputs text to the conversation. It does NOT create files unless the user explicitly asks to save.
